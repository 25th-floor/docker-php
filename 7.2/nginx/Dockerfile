# Beware: This file is generated by the generate.sh script!
FROM 25thfloor/php-fpm:7.2
MAINTAINER 25th-floor GmbH <devops@25th-floor.com>
EXPOSE 80

ENV TZ=Europe/Vienna

RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime \
&& echo $TZ > /etc/timezone \
&& dpkg-reconfigure -f noninteractive tzdata \
&& apt-key adv --fetch-keys http://nginx.org/keys/nginx_signing.key \
&& echo "deb http://nginx.org/packages/mainline/ubuntu/ `grep -oP 'DISTRIB_CODENAME=\K.*' /etc/lsb-release` nginx" >> /etc/apt/sources.list.d/nginx.list \
&& cat /etc/apt/sources.list.d/nginx.list \
&& apt-get update \
&& apt-get install -y supervisor nginx \
&& apt-get clean \
&& rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* \
&& ln -sf /dev/stdout /var/log/nginx/access.log \
&& ln -sf /dev/stderr /var/log/nginx/error.log

COPY supervisord.conf /etc/supervisor/conf.d/supervisord.conf
COPY nginx-site.conf /etc/nginx/conf.d/default.conf

CMD ["/usr/bin/supervisord", "-c", "/etc/supervisor/supervisord.conf"]
