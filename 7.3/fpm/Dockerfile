# Beware: This file is generated by the generate.sh script!
FROM ubuntu:14.04
MAINTAINER 25th-floor GmbH <devops@25th-floor.com>
EXPOSE 9000

ENV DEBIAN_FRONTEND noninteractive
                ENV TZ=Europe/Vienna

                RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime \
	&& echo $TZ > /etc/timezone \
	&& dpkg-reconfigure -f noninteractive tzdata

RUN apt-get update \
	&& apt-get -y dist-upgrade \
	&& apt-get install -y software-properties-common language-pack-en-base language-pack-de git unzip \
	&& LC_ALL=en_US.UTF-8 add-apt-repository ppa:ondrej/php \
	&& apt-get update \
	&& echo "Package: *\nPin: release o=LP-PPA-ondrej-php5\nPin-Priority: 1001" > /etc/apt/preferences.d/ondrej \
	&& apt-get install -y php7.3-fpm php7.3-sqlite3 php7.3-pgsql php7.3-mysql php7.3-mbstring php7.3-intl php7.3-gd php7.3-curl php7.3-xml php7.3-xsl php7.3-xdebug php7.3-zip  \
	&& apt-get install -y php-pear \
	&& apt-get clean \
	&& rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

RUN phpenmod -v 7.3 -s ALL sqlite3 pgsql mysql mbstring intl gd curl xml xsl xdebug zip

# supply but disable xdebug; can be enabled by custom volume-mount ini file
RUN phpdismod -v 7.3 -s ALL xdebug

# install composer
RUN php7.3 -r 'readfile("https://getcomposer.org/installer");' > composer-setup.php \
	&& php7.3 composer-setup.php --install-dir=/usr/local/bin --filename=composer \
	&& rm composer-setup.php

ENV PATH="/home/mbandion/.nvm/versions/node/v10.12.0/bin:/home/mbandion/.local/bin:/home/mbandion/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/home/mbandion/.antigen/bundles/zsh-users/zsh-syntax-highlighting:/home/mbandion/.antigen/bundles/zsh-users/zsh-history-substring-search:/home/mbandion/.antigen/bundles/zsh-users/zsh-autosuggestions:/home/mbandion/.antigen/bundles/arzzen/calc.plugin.zsh:~/bin:~/Applications:/root/.composer/vendor/bin"

# install phing
RUN composer global require phing/phing

# Prepare run directory\nRUN mkdir /run/php\n\nWORKDIR /var/www\n\n" >> 7.3/fpm/Dockerfile
COPY php-fpm.conf /etc/php/7.3/fpm/php-fpm.conf
CMD ["php-fpm7.3"]
